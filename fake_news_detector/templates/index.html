<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ba7ath - Fake News Detection</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&family=Segoe+UI:wght@400;600;700&display=swap');

        :root {
            --brand-red: #a32e2e; /* Matching the deep red from image */
            --brand-cream: #fbf8f1; /* Matching the beige header */
            --brand-dark: #2c3e50;
            --accent-red: #c0392b;
            --text-white: #ffffff;
            --input-bg: rgba(255, 255, 255, 0.95);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', 'Cairo', sans-serif;
            background-color: #e5e5e5; /* Outer background */
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* Main App Container - mimicking the card look */
        .app-container {
            width: 100%;
            min-height: 100vh;
            background: transparent;
            overflow-x: hidden;
            display: flex;
            flex-direction: column;
        }

        /* Header Section - Cream Background */
        header {
            background-color: var(--brand-cream);
            padding: 20px 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo-area {
            display: flex;
            align-items: center;
            gap: 10px;
            color: #6b1c1c; /* Darker red */
            font-weight: 800;
            font-size: 1.8rem;
        }

        .logo-icon {
            font-size: 1.5rem;
            transform: rotate(-10deg);
        }

        .nav-links {
            display: flex;
            gap: 30px;
        }

        .nav-links a {
            text-decoration: none;
            color: black;
            font-weight: 600;
            font-size: 1rem;
            transition: color 0.3s;
        }

        .nav-links a:hover {
            color: var(--brand-red);
        }

        /* Main Body - Deep Red Background */
        .main-body {
            background-color: var(--brand-red);
            padding: 50px;
            color: white;
            flex: 1; /* Takes remaining height */
            position: relative;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        /* Hero Section Layout */
        .hero-grid {
            display: grid;
            grid-template-columns: 1.2fr 0.8fr;
            gap: 40px;
            margin-bottom: 40px;
            align-items: center;
            max-width: 1400px;
            margin-left: auto;
            margin-right: auto;
            width: 100%;
        }

        .hero-text h1 {
            font-size: 3.5rem;
            line-height: 1.2;
            margin-bottom: 20px;
            font-family: 'Cairo', sans-serif; /* Gives it that poster look */
        }

        .hero-text p {
            font-size: 1.2rem;
            opacity: 0.9;
            margin-bottom: 10px;
        }

        .status-badge {
            display: inline-block;
            padding: 6px 12px;
            background: rgba(255,255,255,0.2);
            border-radius: 15px;
            font-size: 0.85rem;
            margin-top: 10px;
        }
        .status-badge.ready { color: #aeffae; }
        .status-badge.error { color: #ffbaba; }

        /* The Image Section */
        .image-container {
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* The "Regular Pic" wrapper */
        .profile-pic-wrapper {
            width: 280px;
            height: 320px;
            background: #d3b488; /* Sepia tone background from ref */
            border-radius: 10px;
            overflow: hidden;
            position: relative;
            box-shadow: 0 10px 20px rgba(0,0,0,0.3);
        }

        .profile-pic-wrapper img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            /* User requested regular pic, but we can add a slight sepia filter to match style */
            filter: blur(4px) sepia(0.3); 
        }

        /* The Magnifying Glass Overlay */
        .magnifying-overlay {
            position: absolute;
            left: -40px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 120px;
            color: #e74c3c; /* Bright red handle */
            text-shadow: 2px 2px 10px rgba(0,0,0,0.3);
            z-index: 2;
        }
        
        /* White circle of the magnifying glass */
        .magnifying-glass-bg {
            position: absolute;
            left: -15px;
            top: 48%;
            transform: translateY(-50%);
            width: 90px;
            height: 90px;
            background: white;
            border-radius: 50%;
            z-index: 1;
        }

        /* Workspace / Functional Area */
        .workspace-card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            color: var(--brand-dark);
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-top: 20px;
            max-width: 1400px;
            margin-left: auto;
            margin-right: auto;
            width: 100%;
        }

        /* Tabs Styling */
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 25px;
            border-bottom: 2px solid #eee;
            padding-bottom: 10px;
        }

        .tab-button {
            background: none;
            border: none;
            padding: 10px 20px;
            font-size: 1rem;
            font-weight: 600;
            color: #7f8c8d;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.3s;
        }

        .tab-button.active {
            background: var(--brand-red);
            color: white;
        }

        .tab-button:hover:not(.active) {
            background: #f0f0f0;
            color: var(--brand-red);
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.4s ease;
        }
        
        .tab-content.active { display: block; }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Inputs */
        .input-group { margin-bottom: 20px; }
        
        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 700;
            color: var(--brand-dark);
        }

        textarea {
            width: 100%;
            padding: 15px;
            border: 2px solid #eee;
            border-radius: 10px;
            font-family: inherit;
            font-size: 1rem;
            resize: vertical;
            min-height: 150px;
            transition: border-color 0.3s;
        }

        textarea:focus {
            outline: none;
            border-color: var(--brand-red);
        }

        /* Buttons */
        .button {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .button-primary {
            background-color: var(--brand-red);
            color: white;
        }

        .button-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(163, 46, 46, 0.4);
        }

        .button-secondary {
            background-color: #f0f0f0;
            color: #333;
            margin-left: 10px;
        }

        /* Result Box */
        .result-box {
            margin-top: 25px;
            padding: 25px;
            border-radius: 12px;
            color: white;
            display: none;
            text-align: center;
        }
        
        .result-box.show { display: block; animation: slideIn 0.3s ease; }

        /* Metrics Grid */
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .metric-card {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            border: 1px solid #eee;
        }

        .metric-card h3 { font-size: 0.9rem; color: #666; margin-bottom: 5px; }
        .metric-value { font-size: 1.5rem; font-weight: 800; color: var(--brand-red); }

        /* Spinner */
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--brand-red);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
            display: none;
        }
        .spinner.active { display: block; }

        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* Responsive */
        @media (max-width: 768px) {
            .hero-grid {
                grid-template-columns: 1fr;
                text-align: center;
            }
            .image-container {
                margin-bottom: 30px;
            }
            header {
                padding: 20px;
                flex-direction: column;
                gap: 15px;
            }
            .magnifying-overlay {
                left: 50%;
                transform: translate(-50%, -50%);
                top: 50%;
            }
            .magnifying-glass-bg {
                left: 50%;
                transform: translate(-50%, -50%);
            }
        }
    </style>
</head>
<body>

    <div class="app-container">
        <!-- Header (Cream Background) -->
        <header>
            <div class="logo-area">
                <i class="fas fa-search logo-icon"></i>
                <span>ba7ath.tn</span>
            </div>
            <nav class="nav-links">
                <a href="#">Accueil</a>
                <a href="#">À propos</a>
                <a href="#">Contact</a>
            </nav>
        </header>

        <!-- Main Body (Red Background) -->
        <div class="main-body">
            
            <!-- Hero Section (Text + Image) -->
            <div class="hero-grid">
                <div class="hero-text">
                    <h1>We search for the truth...<br>and you just read.</h1>
                    <p>The AI-Powered Site for Historical Facts & Verification</p>
                    
                    <div class="status-badge" id="status-badge">
                        <span id="status-text">Loading System...</span>
                    </div>
                </div>

                <!-- The Image Section -->
                <div class="image-container">
                    <div class="magnifying-glass-bg"></div>
                    <i class="fas fa-search magnifying-overlay"></i>
                    <div class="profile-pic-wrapper">
                        <!-- Placeholder image as requested -->
                        <img src="https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?ixlib=rb-4.0.3&auto=format&fit=crop&w=687&q=80" alt="Profile">
                    </div>
                </div>
            </div>

            <!-- Functional Workspace (White Card Overlay) -->
            <div class="workspace-card">
                <div class="tabs">
                    <button class="tab-button active" onclick="switchTab('single')">Single Check</button>
                    <button class="tab-button" onclick="switchTab('batch')">Batch Check</button>
                    <button class="tab-button" onclick="switchTab('analytics')">Analytics</button>
                </div>

                <!-- Error/Success Messages -->
                <div id="error-message" style="color: red; display: none; padding: 10px; margin-bottom: 10px; background: #ffe6e6; border-radius: 5px;"></div>
                <div id="success-message" style="color: green; display: none; padding: 10px; margin-bottom: 10px; background: #e6ffe6; border-radius: 5px;"></div>

                <!-- Single Prediction Tab -->
                <div id="single" class="tab-content active">
                    <div class="input-group">
                        <label for="news-input">Paste Article or Headline:</label>
                        <textarea id="news-input" placeholder="Paste text here to verify..."></textarea>
                    </div>

                    <div style="display: flex; align-items: center;">
                        <button class="button button-primary" onclick="predictNews()">Analyze Now</button>
                        <button class="button button-secondary" onclick="clearInput()">Clear</button>
                    </div>

                    <div class="spinner" id="spinner"></div>

                    <div class="result-box" id="result-box">
                        <h2 id="result-label" style="font-size: 2rem; margin-bottom: 10px;">Fake</h2>
                        <div id="result-confidence" style="font-size: 1.2rem; opacity: 0.9;">95% Confidence</div>
                        
                        <div style="background: rgba(255,255,255,0.2); height: 10px; border-radius: 5px; margin: 15px 0; overflow: hidden;">
                            <div id="confidence-fill" style="width: 95%; height: 100%; background: white;"></div>
                        </div>

                        <div style="display: flex; justify-content: space-between; font-size: 0.9rem;">
                            <span>Fake: <strong id="prob-fake">95%</strong></span>
                            <span>Real: <strong id="prob-real">5%</strong></span>
                        </div>
                    </div>
                </div>

                <!-- Batch Analysis Tab -->
                <div id="batch" class="tab-content">
                    <div class="input-group">
                        <label for="batch-input">Batch Analysis (One per line):</label>
                        <textarea id="batch-input" placeholder="Line 1: News text...&#10;Line 2: News text..."></textarea>
                    </div>
                    <button class="button button-primary" onclick="batchPredict()">Run Batch Analysis</button>
                    <div class="spinner" id="batch-spinner"></div>
                    <div id="batch-results"></div>
                </div>

                <!-- Analytics Tab -->
                <div id="analytics" class="tab-content">
                    <div style="display: flex; gap: 10px; margin-bottom: 20px;">
                        <button class="button button-secondary" onclick="loadVisualizations()">Load Visuals</button>
                        <button class="button button-secondary" onclick="loadMetrics()">Load Metrics</button>
                    </div>
                    <div class="spinner" id="viz-spinner"></div>
                    <div id="metrics-display"></div>
                    <div id="visualizations-grid" style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 20px;"></div>
                </div>
            </div>

            <footer style="text-align: center; margin-top: 30px; opacity: 0.7; font-size: 0.9rem;">
                <p>© 2025 Ba7ath.tn | AI Verification System</p>
            </footer>
        </div>
    </div>

    <script>
        // --- All Original Logic Preserved Below ---

        // Tab switching
        function switchTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.tab-button').forEach(el => el.classList.remove('active'));
            
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }

        // Check model status on load
        function checkModelStatus() {
            fetch('/api/health')
                .then(r => r.json())
                .then(data => {
                    const badge = document.getElementById('status-badge');
                    const text = document.getElementById('status-text');
                    
                    if (data.model_loaded) {
                        badge.className = 'status-badge ready';
                        text.textContent = '✓ Model Ready';
                    } else {
                        badge.className = 'status-badge error';
                        text.textContent = '⚠ Model Not Trained';
                    }
                })
                .catch(() => {
                    const badge = document.getElementById('status-badge');
                    const text = document.getElementById('status-text');
                    badge.className = 'status-badge error';
                    text.textContent = '⚠ Server Not Connected';
                });
        }

        checkModelStatus();
        // setInterval(checkModelStatus, 5000); // Uncomment if needed

        // Single Prediction
        function predictNews() {
            const text = document.getElementById('news-input').value.trim();
            
            if (!text) {
                showError('Please enter some text to analyze');
                return;
            }

            if (text.length < 10) {
                showError('Text must be at least 10 characters long');
                return;
            }

            showSpinner(true);
            clearMessages();

            fetch('/api/predict', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ text })
            })
            .then(r => r.json())
            .then(data => {
                showSpinner(false);
                
                if (data.error) {
                    showError(data.error);
                    return;
                }

                displayResult(data);
                showSuccess('Analysis complete!');
            })
            .catch(err => {
                showSpinner(false);
                // Simulating success for preview since backend isn't here
                // REMOVE THIS BLOCK IN PRODUCTION and keep showError
                /* setTimeout(() => {
                   displayResult({
                       label: "FAKE NEWS",
                       confidence: 88.5,
                       probability_fake: 88.5,
                       probability_real: 11.5,
                       is_fake: true
                   });
                }, 1000);
                */
                showError('Error analyzing text: ' + err.message);
            });
        }

        function displayResult(data) {
            const resultBox = document.getElementById('result-box');
            const resultLabel = document.getElementById('result-label');
            const resultConfidence = document.getElementById('result-confidence');
            const confidenceFill = document.getElementById('confidence-fill');
            const probFake = document.getElementById('prob-fake');
            const probReal = document.getElementById('prob-real');

            resultLabel.textContent = data.label;
            resultConfidence.textContent = data.confidence + '% Confidence';
            confidenceFill.style.width = data.confidence + '%';
            probFake.textContent = data.probability_fake + '%';
            probReal.textContent = data.probability_real + '%';

            // Styling based on result
            if (data.is_fake) {
                resultBox.style.background = 'linear-gradient(135deg, #c0392b, #96281b)'; // Red for fake
            } else {
                resultBox.style.background = 'linear-gradient(135deg, #27ae60, #219150)'; // Green for real
            }
            
            resultBox.classList.add('show');
        }

        // Batch Prediction
        function batchPredict() {
            const text = document.getElementById('batch-input').value.trim();
            
            if (!text) {
                showError('Please enter text to analyze');
                return;
            }

            const texts = text.split('\n').map(t => t.trim()).filter(t => t.length > 0);
            
            if (texts.length === 0) {
                showError('No valid texts found');
                return;
            }

            showBatchSpinner(true);

            fetch('/api/batch-predict', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ texts })
            })
            .then(r => r.json())
            .then(data => {
                showBatchSpinner(false);
                if (data.error) {
                    showError(data.error);
                    return;
                }
                displayBatchResults(data);
            })
            .catch(err => {
                showBatchSpinner(false);
                showError('Error in batch analysis: ' + err.message);
            });
        }

        function displayBatchResults(data) {
            const container = document.getElementById('batch-results');
            let html = '<div class="metrics-grid">';
            
            html += `<div class="metric-card"><h3>Total</h3><div class="metric-value">${data.summary.total}</div></div>`;
            html += `<div class="metric-card"><h3>Fake</h3><div class="metric-value" style="color: #c0392b">${data.summary.fake}</div></div>`;
            html += `<div class="metric-card"><h3>Real</h3><div class="metric-value" style="color: #27ae60">${data.summary.real}</div></div>`;
            html += `</div>`;

            html += '<table style="width: 100%; margin-top: 20px; border-collapse: collapse; background: #fff; border-radius: 8px; overflow: hidden;">';
            html += '<tr style="background: #f8f9fa; text-align: left;"><th style="padding: 12px;">Text</th><th style="padding: 12px;">Type</th><th style="padding: 12px;">Conf.</th></tr>';
            
            data.results.forEach(r => {
                const color = r.is_fake ? '#c0392b' : '#27ae60';
                html += `<tr style="border-bottom: 1px solid #eee;">`;
                html += `<td style="padding: 12px;">${r.text.substring(0, 50)}...</td>`;
                html += `<td style="padding: 12px; color: ${color}; font-weight: bold;">${r.label}</td>`;
                html += `<td style="padding: 12px;">${r.confidence}%</td>`;
                html += `</tr>`;
            });
            
            html += '</table>';
            container.innerHTML = html;
        }

        // Visualizations & Metrics
        function loadVisualizations() {
            const spinner = document.getElementById('viz-spinner');
            const grid = document.getElementById('visualizations-grid');
            
            spinner.classList.add('active');
            grid.innerHTML = '';

            fetch('/api/visualizations')
                .then(r => r.json())
                .then(data => {
                    spinner.classList.remove('active');
                    if (data.error) { showError(data.error); return; }

                    const vizKeys = ['confusion_matrix', 'metrics_chart', 'roc_curve', 'prediction_dist'];
                    let html = '';
                    
                    vizKeys.forEach(key => {
                        if (data.visualizations[key]) {
                            html += `<div style="background: white; padding: 10px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1);">
                                        <img src="data:image/png;base64,${data.visualizations[key]}" style="width: 100%; height: auto;">
                                     </div>`;
                        }
                    });
                    grid.innerHTML = html;
                })
                .catch(err => {
                    spinner.classList.remove('active');
                    showError('Error loading visualizations');
                });
        }

        function loadMetrics() {
            fetch('/api/metrics')
                .then(r => r.json())
                .then(data => {
                    if (data.error) { showError(data.error); return; }
                    
                    const m = data.metrics;
                    let html = '<div class="metrics-grid" style="margin-top: 20px;">';
                    html += `<div class="metric-card"><h3>Accuracy</h3><div class="metric-value">${(m.accuracy * 100).toFixed(1)}%</div></div>`;
                    html += `<div class="metric-card"><h3>Precision</h3><div class="metric-value">${(m.precision * 100).toFixed(1)}%</div></div>`;
                    html += `<div class="metric-card"><h3>Recall</h3><div class="metric-value">${(m.recall * 100).toFixed(1)}%</div></div>`;
                    html += `<div class="metric-card"><h3>F1 Score</h3><div class="metric-value">${(m.f1 * 100).toFixed(1)}%</div></div>`;
                    html += '</div>';
                    
                    document.getElementById('metrics-display').innerHTML = html;
                })
                .catch(err => showError('Error loading metrics'));
        }

        // Utility functions
        function showSpinner(show) { document.getElementById('spinner').classList.toggle('active', show); }
        function showBatchSpinner(show) { document.getElementById('batch-spinner').classList.toggle('active', show); }
        
        function clearInput() {
            document.getElementById('news-input').value = '';
            document.getElementById('result-box').classList.remove('show');
            document.getElementById('error-message').style.display = 'none';
            document.getElementById('success-message').style.display = 'none';
        }

        function showError(msg) {
            const el = document.getElementById('error-message');
            el.textContent = msg;
            el.style.display = 'block';
            setTimeout(() => el.style.display = 'none', 5000);
        }

        function showSuccess(msg) {
            const el = document.getElementById('success-message');
            el.textContent = msg;
            el.style.display = 'block';
            setTimeout(() => el.style.display = 'none', 3000);
        }
        
        function clearMessages() {
            document.getElementById('error-message').style.display = 'none';
            document.getElementById('success-message').style.display = 'none';
        }
    </script>
</body>
</html>